FROM mongo:4.4.0

ARG USER_NAME=elastos
ARG USER_UID=1000
ARG USER_GID=1000
ARG DEBIAN_FRONTEND=noninteractive

# Default password of elastos is 'developer'
# The encrypted password was generated by 'openssl passwd -1 developer'
ENV DEFAULT_PASSWORD '$1$Ezg5Gt2h$mAZfdAiRatxUVdAUp9Qkk.'

ENV LANG=C.UTF-8

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ 'Asia/Shanghai'

RUN set -ex                                                                         && \
                                                                                       \
    echo 'Creating non-root user and group from host'                               && \
    groupadd -f -g $USER_GID $USER_NAME                                             && \
    useradd -lm -p $DEFAULT_PASSWORD -u $USER_UID -g $USER_GID $USER_NAME           && \
    usermod -aG sudo $USER_NAME                                                     && \
    echo 'D' > /etc/debian_chroot                                                   && \
    echo 'Asia/Shanghai' > /etc/timezone                                            && \
    ln -fs /usr/share/zoneinfo/Asia/Shanghai /etc/localtime                         && \
    dpkg-reconfigure --frontend noninteractive tzdata                               && \
    apt-get update && apt-get install -y                                               \
        apt-utils \
        sudo \
        vim \
        autoconf \
        autopoint \
        libtool \
        build-essential \
        valgrind \
        lsb-release \
        net-tools \
        fakeroot \
        tofrodos \
        flex \
        bison \
        texinfo \
        openssl \
        git \
        gperf \
        make \
        bc \
        zip \
        gdbserver \
        bash-completion \
        pkg-config \
        cmake \
        python3 \
        python3-pip \
        python3-venv \
        doxygen \
        python3-sphinx \
        graphviz \
        wget \
        curl \
        tmux \
        libssl-dev \
        zlib1g-dev \
        libncurses5-dev \
        openconnect                                                             && \
    dpkg-reconfigure dash                                                       && \
    rm -rf /var/lib/apt/list/*

RUN pip3 install google-api-python-client
RUN pip3 install google-auth
RUN pip3 install google-auth-oauthlib
RUN pip3 install google-auth-httplib2
RUN pip3 install pymongo
RUN pip3 install Flask
RUN pip3 install Flask-Script
RUN pip3 install Flask-APScheduler
RUN pip3 install eve
RUN pip3 install cffi
RUN pip3 install setuptools
RUN pip3 install base58

USER elastos

VOLUME /home/elastos/Hive.Node
WORKDIR /home/elastos/Hive.Node

